@model BackEndMeutreino.Models.Exercicio

@{
    ViewBag.Title = "Detalhes do Exercício";
    var userRoleClaim = User.Claims.FirstOrDefault(c => c.Type == "role")?.Value;
}

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div>
    <h4>Nome: @Model.nome</h4>
    <h4>Descrição: @Model.descricao</h4>
    <h4>Categoria: @Model.grupoMuscular</h4>
    <img src="@Url.Content(Model.imagem)" alt="Imagem do exercício" width="200">
</div>

@if (userRoleClaim == "admin")
{
    <div class="admin-actions">
        <a href="@Url.Action("EditExercise", "Exercicio", new { id = Model.id })" class="btn btn-warning">Editar</a>
        <a href="@Url.Action("DeleteExercise", "Exercicio", new { id = Model.id })" class="btn btn-danger">Excluir</a>
    </div>
}

<div id="rating">
    <input type="hidden" id="exerciseid" value="@Model.id" />
    <i class="fa fa-star" data-star-value="1"></i>
    <i class="fa fa-star" data-star-value="2"></i>
    <i class="fa fa-star" data-star-value="3"></i>
    <i class="fa fa-star" data-star-value="4"></i>
    <i class="fa fa-star" data-star-value="5"></i>
</div>
<button id="addToFavorites" class="btn btn-primary">Adicionar aos Favoritos</button>

<style>
    #rating .fa-star:hover,
    #rating .fa-star.hover {
        color: orange;
    }

    .admin-actions {
        margin-top: 20px;
    }

        .admin-actions .btn {
            margin-right: 10px;
        }
</style>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function () {
        $('#rating .fa-star').hover(function () {
            $(this).prevAll().addBack().addClass('hover');
        }, function () {
            $(this).prevAll().addBack().removeClass('hover');
        });

        $('#rating .fa-star').click(function () {
            var exerciseid = $('#exerciseid').val();
            var rating = $(this).data('star-value');

            $.ajax({
                url: '/Exercicio/RateExercise',
                type: 'POST',
                data: { exerciseid: exerciseid, rating: rating },
                success: function (response) {
                    alert('Avaliação enviada com sucesso!');
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                    alert('Erro ao enviar a avaliação. Por favor, tente novamente.');
                }
            });
        });

        $('#addToFavorites').click(function () {
            var exerciseid = $('#exerciseid').val();

            $.ajax({
                url: '/Exercicio/AddToFavorites',
                type: 'POST',
                data: { exerciseid: exerciseid },
                success: function (response) {
                    alert('Exercício adicionado aos favoritos!');
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                    alert('Erro ao adicionar aos favoritos. Por favor, tente novamente.');
                }
            });
        });
    });
</script>
